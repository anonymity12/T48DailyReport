# SVI验证最终版.md

![](http://o6qns6y6x.bkt.clouddn.com/18-9-10/69487229.jpg)

# PC1 出口方向

## L3 

1. Ping进程开始下一次ping请求.
2. Ping进程创建一个ICMP Echo 请求消息，并送到底层进程.
3. 进程传来的源IP不是特定的地址，设备就指定IP为我当前网络接口的IP地址.
4. 目标IP和我不在同一个网段，而且也不是广播地址.
5. 默认路由已经设置好了，所以设备决定此消息的下一跳是默认网关.

## L2


1.下一跳IP地址是单播。 ARP进程在ARP表中查找。
2.下一跳IP地址在ARP表中。 ARP进程将帧的目标MAC地址设置为表中找到的MAC地址。
3.设备将PDU封装到以太网帧中。

## L1

1. FastEthernet0发送帧。

# 交换机入口方向

## L1

1. FastEthernet0 / 1接收帧。

## L2

1.帧源MAC地址在多层交换机的MAC表中找到。
2.帧目的MAC地址与活动VLAN接口的MAC地址匹配。
3.帧的目标MAC地址与接收端口的MAC地址，广播地址或多播地址相匹配。
4.设备从以太网帧解封装PDU。

## L3

1.设备在路由表中查找目标IP地址。

# 交换机出口方向

## L3

1.路由表查找到目标IP地址的路由条目。
2.目标网络直接连接。设备将目标设置为下一跳。
3.设备递减数据包上的TTL。

## L2

1.下一跳IP地址是单播。 ARP进程在ARP表中查找。
2.下一跳IP地址在ARP表中。 ARP进程将帧的目标MAC地址设置为表中找到的MAC地址。
3.设备将PDU封装到以太网帧中。
4.多层交换机使用活动VLAN接口作为传出VLAN号。
5.这是一个单播框架。多层交换机在其MAC表中查找目标MAC地址。
6.传出端口是访问端口。多层交换机将帧发送出该端口。

# PC4入口方向

## L2

  1.帧的目标MAC地址与接收端口的MAC地址，广播地址或多播地址相匹配。
  2.设备从以太网帧解封装PDU。

## L3

  1.数据包的目标IP地址与设备的IP地址或广播地址匹配。设备解封装数据包。
  2.数据包是ICMP数据包。 ICMP流程处理它。
  3. ICMP进程收到Echo Request消息。

# PC4出口方向


## L3 

  1. ICMP进程通过将ICMP类型设置为Echo Reply来回复Echo Request。
  2. ICMP进程发送Echo Reply。
  3.目标IP地址不在同一子网中，不是广播地址。
  4.设置默认网关。设备将下一跳设置为默认网关。

## L2

这时是因为PC4不知道自己的网关，PC1那边是知道自己的网关情况的（PC1之前自己有自己发ICMP给网关）。
 
  1.下一跳IP地址是单播。 ARP进程在ARP表中查找。
  2.下一跳IP地址不在ARP表中。 ARP进程尝试发送该IP地址的ARP请求并缓冲此数据包。

## L1

  1. FastEthernet0 / 2接收帧。

# 交换机入口方向

## L2

 1.帧源MAC地址在多层交换机的MAC表中找到。
  2.广播帧目的地MAC地址。多层交换机处理帧。
  3.帧的目标MAC地址与接收端口的MAC地址，广播地址或多播地址相匹配。
  4.设备从以太网帧解封装PDU。
  5.帧是ARP帧。 ARP进程处理它。
  6. ARP帧是一个请求。
  7. ARP请求的目标IP地址与接收端口的IP地址匹配。
  8. ARP进程使用收到的信息更新ARP表。

# 交换机出口方向

## L2

  1. ARP进程使用接收端口的MAC地址回复请求。
  2.设备将PDU封装到以太网帧中。
  3.多层交换机使用活动VLAN接口作为传出VLAN号。
  4.这是一个单播帧。多层交换机在其MAC表中查找目标MAC地址。
  5.传出端口是访问端口。多层交换机将帧发送出该端口。
  6.这是一个广播帧。多层交换机将帧发送到除接收端口之外的同一VLAN中的所有端口。（存在这个广播帧的原因是交换机不得不转发PC4的arp广播请求，即使交换机已经在自己这里处理过了此arp请求）

## L1

  1. FastEthernet0 / 2发送帧。
  2. FastEthernet0 / 3发送帧。

# 回到PC4，入口方向

## L2

  1.帧的目标MAC地址与接收端口的MAC地址，广播地址或多播地址相匹配。
  2.设备从以太网帧解封装PDU。
  3.帧是ARP帧。 ARP进程处理它。
  4. ARP帧是一个回复。
  5. ARP进程使用收到的信息更新ARP表。
  6. ARP进程取出并发送等待该ARP应答的缓冲包。

# PC4，出口方向


## L2

  1. ARP进程从缓冲区中取出该数据包并重新发送。
  2.设备将PDU封装到以太网帧中。

# 交换机，出口方向

前面是arp结束，现在是继续ping过程

交换机的端口2接受到PC4的ICMP回应，进行入口方向L2，L3的处理，然后是出口方向上的L3，L2处理，给出L2处理的详情：


  1.下一跳IP地址是单播。 ARP进程在ARP表中查找。
  2.下一跳IP地址在ARP表中。 ARP进程将帧的目标MAC地址设置为表中找到的MAC地址。
  3.设备将PDU封装到以太网帧中。
  4.多层交换机使用活动VLAN接口作为传出VLAN号。
  5.这是一个单播帧。多层交换机在其MAC表中查找目标MAC地址。
  6.传出端口是访问端口。多层交换机将帧发送出该端口。



L1将消息发送到了PC1 一次ping结束

